{% extends 'base.html' %}
{% load i18n moderation_tags %}
{% block title %}{{ profile_user.display_name }} - {% trans "Profile" %}{% endblock %}

{% block content %}
<div class="container-narrow">
    <div class="card mb-4">
        <div class="card-body text-center">
            {% if profile_user.profile_pic %}
            <img src="{{ profile_user.profile_pic.url }}" alt="Profile" class="rounded-circle mb-3"
                style="width: 120px; height: 120px; object-fit: cover; border-radius: 50%;">
            {% else %}
            <div class="avatar-placeholder mb-3 mx-auto"
                style="width: 120px; height: 120px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold;">
                {{ profile_user.username|make_list|first|upper }}
            </div>
            {% endif %}

            <div style="display: flex; justify-content: center; align-items: center; gap: 0.5rem;">
                <h1>{{ profile_user.display_name }}</h1>
                {% if user.is_authenticated and user != profile_user %}
                <button onclick="openReportModal('{{ profile_user.id }}', '{% get_content_type_id profile_user %}')"
                    style="background:none; border:none; padding:0; cursor:pointer; color: var(--text-muted); display: flex; align-items: center; justify-content: center;"
                    title="{% trans 'Report User' %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" x2="4" y1="22" y2="15"></line>
                    </svg>
                </button>
                {% endif %}
            </div>
            <p class="text-muted">
                {% if profile_user.is_teacher %}{% trans "Teacher" %}{% endif %}
                {% if profile_user.is_teacher and profile_user.is_staff %} & {% endif %}
                {% if profile_user.is_staff %}{% trans "Staff" %}{% endif %}
            </p>

            {% if profile_user.bio %}
            <div class="mt-3">
                <p>{{ profile_user.bio }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="profile-content">
        <h2 class="section-title mb-4">{% trans "Contributions" %}</h2>

        <div class="tabs-header">
            <button class="tab-btn active" onclick="openTab(event, 'lessons')">{% trans "Lessons" %} ({{ lessons.count
                }})</button>
            <button class="tab-btn" onclick="openTab(event, 'tests')">{% trans "Tests" %} ({{ tests.count }})</button>
            <button class="tab-btn" onclick="openTab(event, 'resources')">{% trans "Resources" %} ({{ resources.count
                }})</button>
        </div>

        <div id="lessons" class="tab-content active">
            {% if lessons %}
            <div class="grid">
                {% for lesson in lessons %}
                <div class="card">
                    <div class="card-body">
                        <h3><a href="{% url 'lesson_detail' lesson.pk %}">{{ lesson.title }}</a></h3>
                        <p class="text-muted">{{ lesson.created_at|date:"M d, Y" }}</p>
                        <span class="badge badge-primary">{{ lesson.get_subject_display }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>{% trans "No lessons uploaded yet." %}</p>
            {% endif %}
        </div>

        <div id="tests" class="tab-content">
            {% if tests %}
            <div class="grid">
                {% for test in tests %}
                <div class="card">
                    <div class="card-body">
                        <h3><a href="{% url 'test_detail' test.pk %}">{{ test.title }}</a></h3>
                        <p class="text-muted">{{ test.created_at|date:"M d, Y" }}</p>
                        <span class="badge badge-secondary">{{ test.get_subject_display }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>{% trans "No tests created yet." %}</p>
            {% endif %}
        </div>

        <div id="resources" class="tab-content">
            {% if resources %}
            <div class="grid">
                {% for resource in resources %}
                <div class="card">
                    <div class="card-body">
                        <h3>
                            {% if resource.file %}
                            <a href="{{ resource.file.url }}" target="_blank">{{ resource.title }}</a>
                            {% else %}
                            <a href="{{ resource.url }}" target="_blank">{{ resource.title }}</a>
                            {% endif %}
                        </h3>
                        <p class="text-muted">{{ resource.created_at|date:"M d, Y" }}</p>
                        <span class="badge badge-outline">{{ resource.get_type_display }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>{% trans "No resources shared yet." %}</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function openTab(evt, tabName) {
        var i, tabContent, tabBtns;
        tabContent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabContent.length; i++) {
            tabContent[i].style.display = "none";
            tabContent[i].classList.remove('active');
        }
        tabBtns = document.getElementsByClassName("tab-btn");
        for (i = 0; i < tabBtns.length; i++) {
            tabBtns[i].className = tabBtns[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.className += " active";
    }
</script>
{% include 'moderation/report_modal.html' %}
{% endblock %}