{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div style="max-width: 600px; margin: 4rem auto;">
    <div class="card">
        <h1 class="text-center mb-4">{% trans "Test Results" %}</h1>
        <h2 class="text-center" style="color: var(--primary); margin-bottom: 2rem;">{{ result.test.title }}</h2>

        <div
            style="margin-bottom: 2rem; padding: 2rem; background-color: var(--background); border-radius: var(--radius); text-align: center;">
            <p style="font-size: 1.1rem; margin-bottom: 0.5rem;" class="text-muted">{% trans "Score" %}</p>
            <div style="font-size: 4rem; font-weight: 800; color: var(--text); line-height: 1;">
                {{ result.score }}<span style="font-size: 2rem; color: var(--text-muted);">/{{ result.total_questions }}</span>
            </div>
        </div>

        <div class="grid grid-cols-2 mb-5">
            <div>
                <small class="text-muted">{% trans "Student" %}</small>
                <p>{{ result.student.display_name }}</p>
            </div>
            <div>
                <small class="text-muted">{% trans "Date Taken" %}</small>
                <p>{{ result.date_taken|date:"F j, Y" }}</p>
            </div>
        </div>

        <!-- Feedback Section -->
        <div class="mb-5 pt-4" style="border-top: 2px solid var(--background);">
            <h3 class="mb-3">{% trans "Teacher Feedback" %}</h3>
            {% if result.teacher_feedback %}
            <div class="alert alert-info"
                style="background: rgba(79, 70, 229, 0.05); color: var(--text); border: 1px dashed var(--primary); font-style: italic;">
                "{{ result.teacher_feedback }}"
                <small class="d-block mt-2 text-muted">â€” {{ result.feedback_date|date:"M j, Y" }}</small>
            </div>
            {% else %}
            <p class="text-muted italic">{% trans "No feedback provided yet." %}</p>
            {% endif %}

            {% if user.is_teacher and user == result.test.author %}
            <div class="mt-4">
                <form method="post" action="{% url 'add_feedback' pk=result.pk %}">
                    {% csrf_token %}
                    <label class="form-label">{% if result.teacher_feedback %}{% trans "Update Feedback" %}{% else %}{% trans "Add Feedback" %}{% endif %}</label>
                    <textarea name="feedback" class="form-input" rows="3"
                        placeholder="{% trans 'Great job! Keep working on...' %}">{{ result.teacher_feedback|default:'' }}</textarea>
                    <button type="submit" class="btn btn-secondary btn-sm mt-2">{% trans "Save Feedback" %}</button>
                </form>
            </div>
            {% endif %}
        </div>

        <div class="text-center">
            <a href="{% url 'test_list' %}" class="btn btn-primary">{% trans "Take Another Test" %}</a>
            <a href="{% url 'student_dashboard' %}" class="btn btn-secondary" style="margin-left: 0.5rem;">{% trans "My Dashboard" %}</a>
        </div>
    </div>
</div>
{% endblock %}